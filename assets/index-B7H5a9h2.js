import{t as R,m as Y,n as ee,c as j,u as me,S as we,y as be,j as ie,O as X,o as U,D as I,p as Te,G as Se,H as xe,w as K,a as ye,q as Pe,M as Ee,E as te}from"./index-BTFYkjdL.js";import{b as Ae,L as Ce}from"./request-8Deu8DEV.js";import{u as N}from"./use-expose-DJEx3HXU.js";import{d as W,r as M,D as ne,a as w,E as A,l as F,k as ke,O as _e,H as $e,c as x,n as G,R as Be,G as ae,S as Oe}from"./index-DjzNCYfk.js";const[le,L]=j("swipe"),Re={loop:R,width:ee,height:ee,vertical:Boolean,autoplay:Y(0),duration:Y(500),touchable:R,lazyRender:Boolean,initialSwipe:Y(0),indicatorColor:String,showIndicators:R,stopPropagation:R},oe=Symbol(le);var Me=W({name:le,props:Re,emits:["change","dragStart","dragEnd"],setup(e,{emit:h,slots:c}){const s=M(),d=M(),t=ne({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let T=!1;const v=Ae(),{children:S,linkChildren:n}=me(oe),i=w(()=>S.length),r=w(()=>t[e.vertical?"height":"width"]),f=w(()=>e.vertical?v.deltaY.value:v.deltaX.value),y=w(()=>t.rect?(e.vertical?t.rect.height:t.rect.width)-r.value*i.value:0),u=w(()=>r.value?Math.ceil(Math.abs(y.value)/r.value):i.value),P=w(()=>i.value*r.value),g=w(()=>(t.active+i.value)%i.value),C=w(()=>{const a=e.vertical?"vertical":"horizontal";return v.direction.value===a}),z=w(()=>{const a={transitionDuration:`${t.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+t.offset.toFixed(2)}px)`};if(r.value){const o=e.vertical?"height":"width",l=e.vertical?"width":"height";a[o]=`${P.value}px`,a[l]=e[l]?`${e[l]}px`:""}return a}),re=a=>{const{active:o}=t;return a?e.loop?U(o+a,-1,i.value):U(o+a,0,u.value):o},V=(a,o=0)=>{let l=a*r.value;e.loop||(l=Math.min(l,-y.value));let b=o-l;return e.loop||(b=U(b,y.value,0)),b},E=({pace:a=0,offset:o=0,emitChange:l})=>{if(i.value<=1)return;const{active:b}=t,m=re(a),O=V(m,o);if(e.loop){if(S[0]&&O!==y.value){const H=O<y.value;S[0].setOffset(H?P.value:0)}if(S[i.value-1]&&O!==0){const H=O>0;S[i.value-1].setOffset(H?-P.value:0)}}t.active=m,t.offset=O,l&&m!==b&&h("change",g.value)},D=()=>{t.swiping=!0,t.active<=-1?E({pace:i.value}):t.active>=i.value&&E({pace:-i.value})},ue=()=>{D(),v.reset(),I(()=>{t.swiping=!1,E({pace:-1,emitChange:!0})})},q=()=>{D(),v.reset(),I(()=>{t.swiping=!1,E({pace:1,emitChange:!0})})};let J;const $=()=>clearTimeout(J),B=()=>{$(),+e.autoplay>0&&i.value>1&&(J=setTimeout(()=>{q(),B()},+e.autoplay))},k=(a=+e.initialSwipe)=>{if(!s.value)return;const o=()=>{var l,b;if(!X(s)){const m={width:s.value.offsetWidth,height:s.value.offsetHeight};t.rect=m,t.width=+((l=e.width)!=null?l:m.width),t.height=+((b=e.height)!=null?b:m.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),t.active=a,t.swiping=!0,t.offset=V(a),S.forEach(m=>{m.setOffset(0)}),B()};X(s)?G().then(o):o()},Q=()=>k(t.active);let Z;const de=a=>{!e.touchable||a.touches.length>1||(v.start(a),T=!1,Z=Date.now(),$(),D())},ve=a=>{e.touchable&&t.swiping&&(v.move(a),C.value&&(!e.loop&&(t.active===0&&f.value>0||t.active===i.value-1&&f.value<0)||(Te(a,e.stopPropagation),E({offset:f.value}),T||(h("dragStart",{index:g.value}),T=!0))))},p=()=>{if(!e.touchable||!t.swiping)return;const a=Date.now()-Z,o=f.value/a;if((Math.abs(o)>.25||Math.abs(f.value)>r.value/2)&&C.value){const b=e.vertical?v.offsetY.value:v.offsetX.value;let m=0;e.loop?m=b>0?f.value>0?-1:1:0:m=-Math[f.value>0?"ceil":"floor"](f.value/r.value),E({pace:m,emitChange:!0})}else f.value&&E({pace:0});T=!1,t.swiping=!1,h("dragEnd",{index:g.value}),B()},fe=(a,o={})=>{D(),v.reset(),I(()=>{let l;e.loop&&a===i.value?l=t.active===0?0:a:l=a%i.value,o.immediate?I(()=>{t.swiping=!1}):t.swiping=!1,E({pace:l-t.active,emitChange:!0})})},he=(a,o)=>{const l=o===g.value,b=l?{backgroundColor:e.indicatorColor}:void 0;return x("i",{style:b,class:L("indicator",{active:l})},null)},ge=()=>{if(c.indicator)return c.indicator({active:g.value,total:i.value});if(e.showIndicators&&i.value>1)return x("div",{class:L("indicators",{vertical:e.vertical})},[Array(i.value).fill("").map(he)])};return N({prev:ue,next:q,state:t,resize:Q,swipeTo:fe}),n({size:r,props:e,count:i,activeIndicator:g}),A(()=>e.initialSwipe,a=>k(+a)),A(i,()=>k(t.active)),A(()=>e.autoplay,B),A([Se,xe,()=>e.width,()=>e.height],Q),A(we(),a=>{a==="visible"?B():$()}),F(k),ke(()=>k(t.active)),be(()=>k(t.active)),_e($),$e($),ie("touchmove",ve,{target:d}),()=>{var a;return x("div",{ref:s,class:L()},[x("div",{ref:d,style:z.value,class:L("track",{vertical:e.vertical}),onTouchstartPassive:de,onTouchend:p,onTouchcancel:p},[(a=c.default)==null?void 0:a.call(c)]),ge()])}}});const Fe=K(Me),ze=Symbol(),se=Symbol(),ce=()=>Be(se,null),Ge=e=>{const h=ce();ae(ze,e),ae(se,w(()=>(h==null||h.value)&&e.value))},[De,Ie]=j("swipe-item");var Le=W({name:De,setup(e,{slots:h}){let c;const s=ne({offset:0,inited:!1,mounted:!1}),{parent:d,index:t}=ye(oe);if(!d)return;const T=w(()=>{const n={},{vertical:i}=d.props;return d.size.value&&(n[i?"height":"width"]=`${d.size.value}px`),s.offset&&(n.transform=`translate${i?"Y":"X"}(${s.offset}px)`),n}),v=w(()=>{const{loop:n,lazyRender:i}=d.props;if(!i||c)return!0;if(!s.mounted)return!1;const r=d.activeIndicator.value,f=d.count.value-1,y=r===0&&n?f:r-1,u=r===f&&n?0:r+1;return c=t.value===r||t.value===y||t.value===u,c}),S=n=>{s.offset=n};return F(()=>{G(()=>{s.mounted=!0})}),N({setOffset:S}),()=>{var n;return x("div",{class:Ie(),style:T.value},[v.value?(n=h.default)==null?void 0:n.call(h):null])}}});const Ve=K(Le),[Ye,_,He]=j("list"),Ue={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:Pe("down"),loadingText:String,finishedText:String,immediateCheck:R};var Xe=W({name:Ye,props:Ue,emits:["load","update:error","update:loading"],setup(e,{emit:h,slots:c}){const s=M(e.loading),d=M(),t=M(),T=ce(),v=Ee(d),S=w(()=>e.scroller||v.value),n=()=>{G(()=>{if(s.value||e.finished||e.disabled||e.error||T?.value===!1)return;const{direction:u}=e,P=+e.offset,g=te(S);if(!g.height||X(d))return;let C=!1;const z=te(t);u==="up"?C=g.top-z.top<=P:C=z.bottom-g.bottom<=P,C&&(s.value=!0,h("update:loading",!0),h("load"))})},i=()=>{if(e.finished){const u=c.finished?c.finished():e.finishedText;if(u)return x("div",{class:_("finished-text")},[u])}},r=()=>{h("update:error",!1),n()},f=()=>{if(e.error){const u=c.error?c.error():e.errorText;if(u)return x("div",{role:"button",class:_("error-text"),tabindex:0,onClick:r},[u])}},y=()=>{if(s.value&&!e.finished&&!e.disabled)return x("div",{class:_("loading")},[c.loading?c.loading():x(Ce,{class:_("loading-icon")},{default:()=>[e.loadingText||He("loading")]})])};return A(()=>[e.loading,e.finished,e.error],n),T&&A(T,u=>{u&&n()}),Oe(()=>{s.value=e.loading}),F(()=>{e.immediateCheck&&n()}),N({check:n}),ie("scroll",n,{target:S,passive:!0}),()=>{var u;const P=(u=c.default)==null?void 0:u.call(c),g=x("div",{ref:t,class:_("placeholder")},null);return x("div",{ref:d,role:"feed",class:_(),"aria-busy":s.value},[e.direction==="down"?P:g,y(),i(),f(),e.direction==="up"?P:g])}}});const qe=K(Xe);export{qe as L,Fe as S,Ve as a,Ge as u};
