import{d as B,r as g,u as x,l as C,b as h,f as e,c as n,w as a,p as E,h as D,z as p,o as _,_ as T}from"./index-Cb2cE13u.js";import{C as R,B as M}from"./index-C1y6Uv3e.js";import"./index-h025fBvK.js";import{F as Q}from"./index-D9q8AMaD.js";import{_ as S,F as I}from"./logo2-CB6V-3Dt.js";import{s as O}from"./request-B7DF2lkc.js";import"./use-route-M2jgWhLB.js";import"./index-ztHb5mqS.js";import"./index-yoBmr_vn.js";import"./index-BRBZIbpR.js";import"./constant-CRwwH2e9.js";import"./use-id-BVCG8lro.js";import"./use-expose-DkNTav9O.js";const G={class:"login"},H={class:"login-container"},L={style:{display:"flex","justify-content":"space-between"}},N={style:{margin:"3.7vw 0"}},U=B({__name:"testLogin",setup(V){const m=g(""),u=g(""),d=x(),r=E(),A=g("");function v(l){l=l.replace(/-/g,"+").replace(/_/g,"/");const o=l.length%4;o&&(l+="=".repeat(4-o));const t=Uint8Array.from(atob(l),s=>s.charCodeAt(0));return new TextDecoder().decode(t)}const f=(l,o)=>{O.post(`/api/user/${o}`,l).then(t=>{if(console.log(t.data.status),t.data.status==="OK"){console.log("登录成功");const s=d.query.redirect,i=Array.isArray(s)?s[0]:s||"/";r.replace(i),localStorage.setItem("Authorization",t.data.token_type+" "+t.data.access_token),localStorage.setItem("refresh_token",t.data.refresh_token)}else t.data.status==="NEED_REGISTER"&&(console.log("需要注册"),r.replace("/register?redirect=login"))}).catch(t=>{console.error("toLogin error: ",t)})},w=()=>{if(console.log("handleLogin"),window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData)console.log("Telegram WebApp 登录"),A.value=window.Telegram.WebApp.initData||"",f({initData:A.value},"webapp-login");else{console.log("Telegram Bot 登录");const l=location.origin,o="8303051100";window.location.href=`https://oauth.telegram.org/auth?bot_id=${o}&origin=${l}/login2`}};if(d.hash.includes("tgAuthResult")){console.log(123123123);const l=d.hash.replace("#tgAuthResult=",""),o=JSON.parse(v(l));console.log(o),f(o,"bot-login")}const b=()=>{window.history.state?.back?r.back():r.push("/")};return C(()=>{window.Telegram&&window.Telegram.WebApp&&!localStorage.getItem("Authorization")&&console.log(window.Telegram.WebApp)}),(l,o)=>{const t=Q,s=R,i=D("router-link"),k=M,y=I;return _(),h("div",G,[e("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"返回",class:"left-arrow",onClick:b}),e("div",H,[o[9]||(o[9]=e("div",{class:"logo-section"},[e("img",{src:S,alt:"Logo",class:"logo"})],-1)),n(y,{onSubmit:w},{default:a(()=>[n(s,{inset:"",class:"form-group"},{default:a(()=>[n(t,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=c=>m.value=c),placeholder:"请输入用户名","label-width":"5vw",class:"input-field"},{label:a(()=>o[2]||(o[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M12 12c2.21 0 4-1.79 4-4S14.21 4 12 4 8 5.79 8 8s1.79 4 4 4z"}),e("path",{d:"M12 14c-4 0-8 2-8 6v2h16v-2c0-4-4-6-8-6z"})],-1)])),_:1},8,["modelValue"])]),_:1}),n(s,{inset:"",class:"form-group"},{default:a(()=>[n(t,{modelValue:u.value,"onUpdate:modelValue":o[1]||(o[1]=c=>u.value=c),type:"password",placeholder:"请输入密码","show-message":!1,class:"input-field","label-width":"5vw"},{label:a(()=>o[3]||(o[3]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})],-1)])),_:1},8,["modelValue"])]),_:1}),e("div",L,[n(i,{to:{name:"register"},class:"link"},{default:a(()=>o[4]||(o[4]=[p("立即注册")])),_:1,__:[4]}),n(i,{to:"",class:"link"},{default:a(()=>o[5]||(o[5]=[p("忘记密码")])),_:1,__:[5]})]),e("div",N,[n(k,{block:"",type:"primary","native-type":"submit"},{default:a(()=>o[6]||(o[6]=[p(" 登录 ")])),_:1,__:[6]})]),o[8]||(o[8]=e("div",{class:"divider"},"快速登录",-1)),(_(),h("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 80 80",class:"tg-icon",onClick:w},o[7]||(o[7]=[e("g",{"clip-path":"url(#i389236776__a)"},[e("ellipse",{cx:"39.5",cy:"39.5",fill:"#fff",rx:"31.5",ry:"30.5"}),e("path",{fill:"#1296DB",d:"m53.08 58.349 6.563-30.938c.58-2.722-.983-3.794-2.769-3.125L18.303 39.15c-2.635 1.026-2.589 2.5-.446 3.169l9.866 3.08 22.903-14.42c1.071-.714 2.054-.311 1.251.403l-18.526 16.74-.714 10.18c1.026 0 1.474-.446 2.009-.983l4.82-4.643 10 7.366c1.831 1.026 3.126.491 3.617-1.697l-.003.003ZM80 40c0 22.097-17.903 40-40 40S0 62.097 0 40 17.903 0 40 0s40 17.903 40 40Z"})],-1),e("defs",null,[e("clipPath",{id:"i389236776__a"},[e("path",{fill:"#fff",d:"M0 0h80v80H0z"})])],-1)])))]),_:1,__:[8]})])])}}}),eo=T(U,[["__scopeId","data-v-3c2029de"]]);export{eo as default};
