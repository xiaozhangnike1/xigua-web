import{t as M,m as Y,n as ee,c as H,u as me,Z as we,J as Te,h as ie,W as X,y as W,L as I,p as be,O as xe,Q as Se,w as K,a as ye,k as Pe,U as ke,M as te}from"./index-vKgYhTR5.js";import{a as Ae,u as N}from"./use-touch-CdP2QCc-.js";import{d as j,r as O,L as ne,a as w,H as A,l as F,k as Ce,E as Ee,G as _e,c as S,n as J,W as $e,J as ae,X as Be}from"./index-Ha6_R1b4.js";import{L as Le}from"./index-BRbdKhwT.js";const[le,D]=H("swipe"),Me={loop:M,width:ee,height:ee,vertical:Boolean,autoplay:Y(0),duration:Y(500),touchable:M,lazyRender:Boolean,initialSwipe:Y(0),indicatorColor:String,showIndicators:M,stopPropagation:M},oe=Symbol(le);var Oe=j({name:le,props:Me,emits:["change","dragStart","dragEnd"],setup(e,{emit:h,slots:c}){const s=O(),d=O(),t=ne({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let b=!1;const v=Ae(),{children:x,linkChildren:n}=me(oe),i=w(()=>x.length),r=w(()=>t[e.vertical?"height":"width"]),f=w(()=>e.vertical?v.deltaY.value:v.deltaX.value),y=w(()=>t.rect?(e.vertical?t.rect.height:t.rect.width)-r.value*i.value:0),u=w(()=>r.value?Math.ceil(Math.abs(y.value)/r.value):i.value),P=w(()=>i.value*r.value),g=w(()=>(t.active+i.value)%i.value),C=w(()=>{const a=e.vertical?"vertical":"horizontal";return v.direction.value===a}),R=w(()=>{const a={transitionDuration:`${t.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+t.offset.toFixed(2)}px)`};if(r.value){const o=e.vertical?"height":"width",l=e.vertical?"width":"height";a[o]=`${P.value}px`,a[l]=e[l]?`${e[l]}px`:""}return a}),re=a=>{const{active:o}=t;return a?e.loop?W(o+a,-1,i.value):W(o+a,0,u.value):o},V=(a,o=0)=>{let l=a*r.value;e.loop||(l=Math.min(l,-y.value));let T=o-l;return e.loop||(T=W(T,y.value,0)),T},k=({pace:a=0,offset:o=0,emitChange:l})=>{if(i.value<=1)return;const{active:T}=t,m=re(a),L=V(m,o);if(e.loop){if(x[0]&&L!==y.value){const U=L<y.value;x[0].setOffset(U?P.value:0)}if(x[i.value-1]&&L!==0){const U=L>0;x[i.value-1].setOffset(U?-P.value:0)}}t.active=m,t.offset=L,l&&m!==T&&h("change",g.value)},z=()=>{t.swiping=!0,t.active<=-1?k({pace:i.value}):t.active>=i.value&&k({pace:-i.value})},ue=()=>{z(),v.reset(),I(()=>{t.swiping=!1,k({pace:-1,emitChange:!0})})},G=()=>{z(),v.reset(),I(()=>{t.swiping=!1,k({pace:1,emitChange:!0})})};let Q;const $=()=>clearTimeout(Q),B=()=>{$(),+e.autoplay>0&&i.value>1&&(Q=setTimeout(()=>{G(),B()},+e.autoplay))},E=(a=+e.initialSwipe)=>{if(!s.value)return;const o=()=>{var l,T;if(!X(s)){const m={width:s.value.offsetWidth,height:s.value.offsetHeight};t.rect=m,t.width=+((l=e.width)!=null?l:m.width),t.height=+((T=e.height)!=null?T:m.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),t.active=a,t.swiping=!0,t.offset=V(a),x.forEach(m=>{m.setOffset(0)}),B()};X(s)?J().then(o):o()},Z=()=>E(t.active);let q;const de=a=>{!e.touchable||a.touches.length>1||(v.start(a),b=!1,q=Date.now(),$(),z())},ve=a=>{e.touchable&&t.swiping&&(v.move(a),C.value&&(!e.loop&&(t.active===0&&f.value>0||t.active===i.value-1&&f.value<0)||(be(a,e.stopPropagation),k({offset:f.value}),b||(h("dragStart",{index:g.value}),b=!0))))},p=()=>{if(!e.touchable||!t.swiping)return;const a=Date.now()-q,o=f.value/a;if((Math.abs(o)>.25||Math.abs(f.value)>r.value/2)&&C.value){const T=e.vertical?v.offsetY.value:v.offsetX.value;let m=0;e.loop?m=T>0?f.value>0?-1:1:0:m=-Math[f.value>0?"ceil":"floor"](f.value/r.value),k({pace:m,emitChange:!0})}else f.value&&k({pace:0});b=!1,t.swiping=!1,h("dragEnd",{index:g.value}),B()},fe=(a,o={})=>{z(),v.reset(),I(()=>{let l;e.loop&&a===i.value?l=t.active===0?0:a:l=a%i.value,o.immediate?I(()=>{t.swiping=!1}):t.swiping=!1,k({pace:l-t.active,emitChange:!0})})},he=(a,o)=>{const l=o===g.value,T=l?{backgroundColor:e.indicatorColor}:void 0;return S("i",{style:T,class:D("indicator",{active:l})},null)},ge=()=>{if(c.indicator)return c.indicator({active:g.value,total:i.value});if(e.showIndicators&&i.value>1)return S("div",{class:D("indicators",{vertical:e.vertical})},[Array(i.value).fill("").map(he)])};return N({prev:ue,next:G,state:t,resize:Z,swipeTo:fe}),n({size:r,props:e,count:i,activeIndicator:g}),A(()=>e.initialSwipe,a=>E(+a)),A(i,()=>E(t.active)),A(()=>e.autoplay,B),A([xe,Se,()=>e.width,()=>e.height],Z),A(we(),a=>{a==="visible"?B():$()}),F(E),Ce(()=>E(t.active)),Te(()=>E(t.active)),Ee($),_e($),ie("touchmove",ve,{target:d}),()=>{var a;return S("div",{ref:s,class:D()},[S("div",{ref:d,style:R.value,class:D("track",{vertical:e.vertical}),onTouchstartPassive:de,onTouchend:p,onTouchcancel:p},[(a=c.default)==null?void 0:a.call(c)]),ge()])}}});const Fe=K(Oe),Re=Symbol(),se=Symbol(),ce=()=>$e(se,null),Je=e=>{const h=ce();ae(Re,e),ae(se,w(()=>(h==null||h.value)&&e.value))},[ze,Ie]=H("swipe-item");var De=j({name:ze,setup(e,{slots:h}){let c;const s=ne({offset:0,inited:!1,mounted:!1}),{parent:d,index:t}=ye(oe);if(!d)return;const b=w(()=>{const n={},{vertical:i}=d.props;return d.size.value&&(n[i?"height":"width"]=`${d.size.value}px`),s.offset&&(n.transform=`translate${i?"Y":"X"}(${s.offset}px)`),n}),v=w(()=>{const{loop:n,lazyRender:i}=d.props;if(!i||c)return!0;if(!s.mounted)return!1;const r=d.activeIndicator.value,f=d.count.value-1,y=r===0&&n?f:r-1,u=r===f&&n?0:r+1;return c=t.value===r||t.value===y||t.value===u,c}),x=n=>{s.offset=n};return F(()=>{J(()=>{s.mounted=!0})}),N({setOffset:x}),()=>{var n;return S("div",{class:Ie(),style:b.value},[v.value?(n=h.default)==null?void 0:n.call(h):null])}}});const Ve=K(De),[Ye,_,Ue]=H("list"),We={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:Pe("down"),loadingText:String,finishedText:String,immediateCheck:M};var Xe=j({name:Ye,props:We,emits:["load","update:error","update:loading"],setup(e,{emit:h,slots:c}){const s=O(e.loading),d=O(),t=O(),b=ce(),v=ke(d),x=w(()=>e.scroller||v.value),n=()=>{J(()=>{if(s.value||e.finished||e.disabled||e.error||b?.value===!1)return;const{direction:u}=e,P=+e.offset,g=te(x);if(!g.height||X(d))return;let C=!1;const R=te(t);u==="up"?C=g.top-R.top<=P:C=R.bottom-g.bottom<=P,C&&(s.value=!0,h("update:loading",!0),h("load"))})},i=()=>{if(e.finished){const u=c.finished?c.finished():e.finishedText;if(u)return S("div",{class:_("finished-text")},[u])}},r=()=>{h("update:error",!1),n()},f=()=>{if(e.error){const u=c.error?c.error():e.errorText;if(u)return S("div",{role:"button",class:_("error-text"),tabindex:0,onClick:r},[u])}},y=()=>{if(s.value&&!e.finished&&!e.disabled)return S("div",{class:_("loading")},[c.loading?c.loading():S(Le,{class:_("loading-icon")},{default:()=>[e.loadingText||Ue("loading")]})])};return A(()=>[e.loading,e.finished,e.error],n),b&&A(b,u=>{u&&n()}),Be(()=>{s.value=e.loading}),F(()=>{e.immediateCheck&&n()}),N({check:n}),ie("scroll",n,{target:x,passive:!0}),()=>{var u;const P=(u=c.default)==null?void 0:u.call(c),g=S("div",{ref:t,class:_("placeholder")},null);return S("div",{ref:d,role:"feed",class:_(),"aria-busy":s.value},[e.direction==="down"?P:g,y(),i(),f(),e.direction==="up"?P:g])}}});const Ge=K(Xe);export{Ge as L,Fe as S,Ve as a,Je as u};
