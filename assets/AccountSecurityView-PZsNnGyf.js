import{d as Z,r as c,k as J,u as L,b as k,c as a,f as r,w as o,F as j,p as W,m as z,B as F,C as H,D as B,t as D,z as h,o as _,_ as K}from"./index-DO-l4tIR.js";import{C as q}from"./index-C8IO6k9C.js";import{F as $}from"./index-BQ62ZMvP.js";import{C as ee,B as le}from"./index-CzWMtT1i.js";import{N as ae}from"./index-CFyyyUlW.js";import{s as b}from"./request-vocc818-.js";import{s as oe,P as te,a as n}from"./function-call-CaVRAmu7.js";import{w as se}from"./index-BZ0O1QaC.js";import{I as ne}from"./index-C0LVEZzw.js";import"./use-route-lDfftLAJ.js";import"./use-id-DRzkz_RB.js";import"./use-expose-buKm2G0G.js";import"./constant-CRwwH2e9.js";import"./index-T6Dye2l5.js";import"./use-placeholder-7sMPt_fA.js";import"./on-popup-reopen-D5u2-ffw.js";import"./use-touch-Uh-j500R.js";import"./interceptor-CeEcvsXT.js";se(oe);const re={class:"overflow_y-auto"},ie={style:{margin:"5vw 5vw"}},ue={class:"content-wrap"},ce={key:0,class:"content-wrap"},de={key:1,class:"content-wrap"},me=Z({__name:"AccountSecurityView",setup(ve){const C=W(),w=c(!1),m=c(!1),A=c(""),g=c(""),i=c(""),d=c(""),V=c(""),E=c(""),x=L(),t=c({email:"",nickname:"",username:"",firstName:"",lastName:"",hasTelegram:!1,isActive:!1,createdAt:""});J(async()=>{try{const l=await b.get("/api/user/me");t.value=l.data}catch(l){console.error(l)}});const Q=()=>{C.push("/settings")},R=l=>/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/.test(l),N=async()=>{try{await navigator.clipboard.writeText(t.value.username),n("已复制到剪切板")}catch(l){n("复制失败"),console.error(l)}},O=()=>{localStorage.removeItem("Authorization"),C.push("/")},G=async()=>{const l={nickname:A.value};try{const e=await b.post("/api/user/update-nickname",l);e.data.success?(n("昵称修改成功"),w.value=!1):n(e.data.message)}catch(e){console.error("bind_account:",e),n("请求异常")}},M=async()=>{const l={oldPassword:V.value,newPassword:i.value,confirmPassword:d.value};try{const e=await b.post("/api/user/update-password",l);return e.data.success?(n("密码修改成功"),!1):(n(e.data.message),!0)}catch(e){return console.error("bind_account:",e),n("请求异常"),!0}},P=async()=>{if(!R(g.value))return n("邮箱格式不正确"),!0;const l={email:g.value,password:i.value,confirmPassword:d.value};try{const e=await b.post("/api/user/bind-email",l);return e.data.success?(n("邮箱绑定成功"),!1):(n(e.data.message),!0)}catch(e){return console.error("bind_account:",e),n("请求异常"),!0}},U=async()=>{let l=!0;if(i.value.length<6||i.value.length>20){n("密码长度必须在 6-20 位");return}if(i.value!==d.value){n("两次密码输入不一致");return}t.value.email?l=await M():l=await P(),console.log("点击成功"),m.value=l},I=(l,e)=>{b.post(e,l).then(u=>{u.data.access_token?(localStorage.setItem("Authorization",u.data.token_type+" "+u.data.access_token),localStorage.setItem("refresh_token",u.data.refresh_token),C.replace("/info"),n("telegram 绑定成功")):n("telegram 绑定失败")}).catch(u=>{console.error("toLogin error: ",u)})},X=()=>{if(window.Telegram&&window.Telegram.WebApp&&window.Telegram.WebApp.initData)console.log("Telegram WebApp 登录"),E.value=window.Telegram.WebApp.initData||"",I({initData:E.value},"/api/auth/telegram/webapp-login");else{console.log("Telegram Bot 登录");const l=location.origin,e="8303051100";window.location.href=`https://oauth.telegram.org/auth?bot_id=${e}&origin=${l}/info`}};function Y(l){l=l.replace(/-/g,"+").replace(/_/g,"/");const e=l.length%4;e&&(l+="=".repeat(4-e));const u=Uint8Array.from(atob(l),v=>v.charCodeAt(0));return new TextDecoder().decode(u)}if(x.hash.includes("tgAuthResult")){const l=x.hash.replace("#tgAuthResult=",""),e=JSON.parse(Y(l));I(e,"/api/auth/telegram/bot-login")}return(l,e)=>{const u=ae,v=q,T=ne,f=ee,y=le,p=$,S=te;return _(),k(j,null,[a(u,{title:"账号与安全","left-arrow":"",class:"relative nav-bar",style:{color:"aliceblue"},onClickLeft:Q},{left:o(()=>e[13]||(e[13]=[r("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAXNJREFUaEPt2TtKBEEYReFzMZMBd+ASXIGBmhgaGbkDlyGGJgYuQBAjAzP3YOoCRMHcRMTEkoYOOpgHXfU/ZrArmWD6cb6qoXqgxYYPbXg/EyB7BacV+LcrUEqZAXfAEXAl6aJmMlJ+Qn38E7DfR/8CM0nfYxHhgDnxXfOLpL2x8d3xoYAF8a/AoaS3tQZ4xIetgFd8CMAz3h3gHe8KiIh3AyyJP5D0XrPbLDrHfBuNjDdfgeh4U0BGvBkgK94EkBnfDMiObwKsQ3wr4BE4GezP3b9K831+1TOj+jlQSvkCtgc3OJX0sOqG1t+3AG6A80HQJ3As6dk6ctn1WgBbwC1wlomoBnTRpZR0RBNgHRDNgGyECSATYQbIQpgCMhDmgGiECyAS4QaIQrgCIhDuAG9ECMATEQbwQoQCliA+gF1J3YuOUSMcsADxA+xI6j5HjRTAAHHZvyO7lnQ/qrw/OA1QEzvvnAlgNZO115lWoHbmrM77A89a2jFh78iUAAAAAElFTkSuQmCC",alt:"",class:"left-arrow"},null,-1)])),right:o(()=>e[14]||(e[14]=[])),_:1}),r("div",re,[a(f,{style:{width:"93%",margin:"3vw auto"}},{default:o(()=>[a(v,{class:"van-cell-line",title:"ID",icon:"user-o",value:t.value.username},{"right-icon":o(()=>[(_(),k("svg",{onClick:N,class:"svg-icon",style:{"margin-left":"3vw",width:"1em",height:"1em","vertical-align":"middle",fill:"currentColor",overflow:"hidden"},viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},e[15]||(e[15]=[r("path",{d:"M866.461538 39.384615H354.461538c-43.323077 0-78.769231 35.446154-78.76923 78.769231v39.384616h472.615384c43.323077 0 78.769231 35.446154 78.769231 78.76923v551.384616h39.384615c43.323077 0 78.769231-35.446154 78.769231-78.769231V118.153846c0-43.323077-35.446154-78.769231-78.769231-78.769231z m-118.153846 275.692308c0-43.323077-35.446154-78.769231-78.76923-78.769231H157.538462c-43.323077 0-78.769231 35.446154-78.769231 78.769231v590.769231c0 43.323077 35.446154 78.769231 78.769231 78.769231h512c43.323077 0 78.769231-35.446154 78.76923-78.769231V315.076923z m-354.461538 137.846154c0 11.815385-7.876923 19.692308-19.692308 19.692308h-157.538461c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h157.538461c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z m157.538461 315.076923c0 11.815385-7.876923 19.692308-19.692307 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h315.076923c11.815385 0 19.692308 7.876923 19.692307 19.692308v39.384615z m78.769231-157.538462c0 11.815385-7.876923 19.692308-19.692308 19.692308H216.615385c-11.815385 0-19.692308-7.876923-19.692308-19.692308v-39.384615c0-11.815385 7.876923-19.692308 19.692308-19.692308h393.846153c11.815385 0 19.692308 7.876923 19.692308 19.692308v39.384615z"},null,-1)])))]),_:1},8,["value"]),a(v,{class:"van-cell-line",title:"昵称",icon:"smile-o",value:t.value.nickname},{"right-icon":o(()=>[a(T,{onClick:e[0]||(e[0]=()=>{w.value=!w.value}),name:"edit",style:{"margin-left":"3vw"}})]),_:1},8,["value"])]),_:1}),a(f,{style:{width:"93%",margin:"3vw auto"}},{default:o(()=>[a(v,z({class:"van-cell-line",title:"邮箱",icon:"envelop-o","is-link":!t.value.email},F(t.value.email?{}:{click:()=>{m.value=!m.value}})),H({value:o(()=>[r("span",{style:B({color:t.value.email?"":"#FF7875"})},D(t.value.email||"未设置"),5)]),_:2},[t.value.email?{name:"right-icon",fn:o(()=>[a(T,{name:"certificate",style:{"margin-left":"3vw"}})]),key:"0"}:void 0]),1040,["is-link"]),a(v,{class:"van-cell-line",title:"密码",icon:"lock","is-link":"",onClick:e[1]||(e[1]=()=>{m.value=!m.value})},{value:o(()=>[r("span",{style:B({color:t.value.email?"":"#FF7875"})},D(t.value.email?"修改":"未设置"),5)]),_:1}),a(v,z({class:"van-cell-line",title:"Telegram","is-link":!t.value.hasTelegram,icon:"guide-o"},F(t.value.hasTelegram?{}:{click:X})),H({value:o(()=>[r("span",{style:B({color:t.value.hasTelegram?"":"#FF7875"})},D(t.value.hasTelegram?"seo99991":"未设置"),5)]),_:2},[t.value.hasTelegram?{name:"right-icon",fn:o(()=>[a(T,{name:"certificate",style:{"margin-left":"3vw"}})]),key:"0"}:void 0]),1040,["is-link"])]),_:1}),r("div",ie,[a(y,{block:"",class:"logout",type:"primary",onClick:O},{default:o(()=>e[16]||(e[16]=[h(" 退出登录 ")])),_:1,__:[16]})])]),a(S,{"close-icon":"clear",show:w.value,"onUpdate:show":e[3]||(e[3]=s=>w.value=s),closeable:"",style:{padding:"3vw","border-radius":"2vw","background-color":"#1c1c1b"},onOpen:e[4]||(e[4]=()=>{A.value=t.value.nickname})},{default:o(()=>[r("div",ue,[e[18]||(e[18]=r("div",{class:"title"},"昵称修改",-1)),a(f,{style:{margin:"4vw 0"}},{default:o(()=>[a(p,{"label-width":"10vw",modelValue:A.value,"onUpdate:modelValue":e[2]||(e[2]=s=>A.value=s),clearable:"","left-icon":"smile-o",label:"昵称","input-align":"left",placeholder:"请输入昵称",style:{"border-radius":"1vw"}},null,8,["modelValue"])]),_:1}),a(y,{block:"",class:"custom-btn",type:"primary",onClick:G},{default:o(()=>e[17]||(e[17]=[h(" 确认 ")])),_:1,__:[17]})])]),_:1},8,["show"]),a(S,{"close-icon":"clear",show:m.value,"onUpdate:show":e[11]||(e[11]=s=>m.value=s),closeable:"",style:{padding:"3vw","border-radius":"2vw","background-color":"#1c1c1b"},onClose:e[12]||(e[12]=()=>{i.value="",d.value="",g.value=""})},{default:o(()=>[t.value.email?(_(),k("div",ce,[e[20]||(e[20]=r("div",{class:"title"},"密码修改",-1)),a(f,{style:{margin:"4vw 0"}},{default:o(()=>[a(p,{"label-width":"10vw",modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=s=>V.value=s),"left-icon":"lock",label:"旧",placeholder:"请输入当前密码",style:{"border-radius":"1vw"},type:"password"},null,8,["modelValue"]),a(p,{"label-width":"10vw",modelValue:i.value,"onUpdate:modelValue":e[6]||(e[6]=s=>i.value=s),"left-icon":"lock",label:"新",placeholder:"请输入新密码",style:{"border-radius":"1vw"},type:"password"},null,8,["modelValue"]),a(p,{"label-width":"10vw",modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=s=>d.value=s),"left-icon":"lock",label:"新",placeholder:"请再次输入密码",style:{"border-radius":"1vw"},type:"password"},null,8,["modelValue"])]),_:1}),a(y,{block:"",class:"custom-btn",type:"primary",onClick:U},{default:o(()=>e[19]||(e[19]=[h(" 确认 ")])),_:1,__:[19]})])):(_(),k("div",de,[e[22]||(e[22]=r("div",{class:"title"},"绑定邮箱（注册账号）",-1)),a(f,{style:{margin:"4vw 0"}},{default:o(()=>[a(p,{"label-width":"10vw",modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=s=>g.value=s),"left-icon":"envelop-o",label:"邮箱",placeholder:"请输入邮箱",style:{"border-radius":"1vw"},type:"email"},null,8,["modelValue"]),a(p,{"label-width":"10vw",modelValue:i.value,"onUpdate:modelValue":e[9]||(e[9]=s=>i.value=s),"left-icon":"lock",label:"密码",placeholder:"请输入新密码",style:{"border-radius":"1vw"},type:"password"},null,8,["modelValue"]),a(p,{"label-width":"10vw",modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=s=>d.value=s),"left-icon":"lock",label:"密码",placeholder:"请再次输入密码",style:{"border-radius":"1vw"},type:"password"},null,8,["modelValue"])]),_:1}),a(y,{block:"",class:"custom-btn",type:"primary",onClick:U},{default:o(()=>e[21]||(e[21]=[h(" 确认 ")])),_:1,__:[21]})]))]),_:1},8,["show"])],64)}}}),Ie=K(me,[["__scopeId","data-v-89d43eac"]]);export{Ie as default};
