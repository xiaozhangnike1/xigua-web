import{t as R,m as Y,n as ee,c as U,u as me,S as we,f as ie,P as X,A as N,G as O,p as Te,I as be,J as Se,w as W,a as xe,j as ye,N as Pe,H as te}from"./index-yoBmr_vn.js";import{u as Ae}from"./use-touch-BirIZBgw.js";import{u as j}from"./use-expose-DkNTav9O.js";import{o as Ce}from"./on-popup-reopen-CUWHvshY.js";import{d as K,r as z,N as ne,a as w,H as C,l as F,k as Ee,E as ke,G as _e,c as x,n as G,W as $e,J as ae,X as Be}from"./index-Cb2cE13u.js";import{L as Ie}from"./index-BRBZIbpR.js";const[oe,D]=U("swipe"),Re={loop:R,width:ee,height:ee,vertical:Boolean,autoplay:Y(0),duration:Y(500),touchable:R,lazyRender:Boolean,initialSwipe:Y(0),indicatorColor:String,showIndicators:R,stopPropagation:R},le=Symbol(oe);var ze=K({name:oe,props:Re,emits:["change","dragStart","dragEnd"],setup(e,{emit:h,slots:r}){const s=z(),d=z(),t=ne({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let b=!1;const f=Ae(),{children:S,linkChildren:n}=me(le),i=w(()=>S.length),c=w(()=>t[e.vertical?"height":"width"]),v=w(()=>e.vertical?f.deltaY.value:f.deltaX.value),y=w(()=>t.rect?(e.vertical?t.rect.height:t.rect.width)-c.value*i.value:0),u=w(()=>c.value?Math.ceil(Math.abs(y.value)/c.value):i.value),P=w(()=>i.value*c.value),g=w(()=>(t.active+i.value)%i.value),E=w(()=>{const a=e.vertical?"vertical":"horizontal";return f.direction.value===a}),L=w(()=>{const a={transitionDuration:`${t.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+t.offset.toFixed(2)}px)`};if(c.value){const l=e.vertical?"height":"width",o=e.vertical?"width":"height";a[l]=`${P.value}px`,a[o]=e[o]?`${e[o]}px`:""}return a}),ce=a=>{const{active:l}=t;return a?e.loop?N(l+a,-1,i.value):N(l+a,0,u.value):l},J=(a,l=0)=>{let o=a*c.value;e.loop||(o=Math.min(o,-y.value));let T=l-o;return e.loop||(T=N(T,y.value,0)),T},A=({pace:a=0,offset:l=0,emitChange:o})=>{if(i.value<=1)return;const{active:T}=t,m=ce(a),I=J(m,l);if(e.loop){if(S[0]&&I!==y.value){const H=I<y.value;S[0].setOffset(H?P.value:0)}if(S[i.value-1]&&I!==0){const H=I>0;S[i.value-1].setOffset(H?-P.value:0)}}t.active=m,t.offset=I,o&&m!==T&&h("change",g.value)},M=()=>{t.swiping=!0,t.active<=-1?A({pace:i.value}):t.active>=i.value&&A({pace:-i.value})},ue=()=>{M(),f.reset(),O(()=>{t.swiping=!1,A({pace:-1,emitChange:!0})})},V=()=>{M(),f.reset(),O(()=>{t.swiping=!1,A({pace:1,emitChange:!0})})};let q;const $=()=>clearTimeout(q),B=()=>{$(),+e.autoplay>0&&i.value>1&&(q=setTimeout(()=>{V(),B()},+e.autoplay))},k=(a=+e.initialSwipe)=>{if(!s.value)return;const l=()=>{var o,T;if(!X(s)){const m={width:s.value.offsetWidth,height:s.value.offsetHeight};t.rect=m,t.width=+((o=e.width)!=null?o:m.width),t.height=+((T=e.height)!=null?T:m.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),t.active=a,t.swiping=!0,t.offset=J(a),S.forEach(m=>{m.setOffset(0)}),B()};X(s)?G().then(l):l()},Q=()=>k(t.active);let Z;const de=a=>{!e.touchable||a.touches.length>1||(f.start(a),b=!1,Z=Date.now(),$(),M())},fe=a=>{e.touchable&&t.swiping&&(f.move(a),E.value&&(!e.loop&&(t.active===0&&v.value>0||t.active===i.value-1&&v.value<0)||(Te(a,e.stopPropagation),A({offset:v.value}),b||(h("dragStart",{index:g.value}),b=!0))))},p=()=>{if(!e.touchable||!t.swiping)return;const a=Date.now()-Z,l=v.value/a;if((Math.abs(l)>.25||Math.abs(v.value)>c.value/2)&&E.value){const T=e.vertical?f.offsetY.value:f.offsetX.value;let m=0;e.loop?m=T>0?v.value>0?-1:1:0:m=-Math[v.value>0?"ceil":"floor"](v.value/c.value),A({pace:m,emitChange:!0})}else v.value&&A({pace:0});b=!1,t.swiping=!1,h("dragEnd",{index:g.value}),B()},ve=(a,l={})=>{M(),f.reset(),O(()=>{let o;e.loop&&a===i.value?o=t.active===0?0:a:o=a%i.value,l.immediate?O(()=>{t.swiping=!1}):t.swiping=!1,A({pace:o-t.active,emitChange:!0})})},he=(a,l)=>{const o=l===g.value,T=o?{backgroundColor:e.indicatorColor}:void 0;return x("i",{style:T,class:D("indicator",{active:o})},null)},ge=()=>{if(r.indicator)return r.indicator({active:g.value,total:i.value});if(e.showIndicators&&i.value>1)return x("div",{class:D("indicators",{vertical:e.vertical})},[Array(i.value).fill("").map(he)])};return j({prev:ue,next:V,state:t,resize:Q,swipeTo:ve}),n({size:c,props:e,count:i,activeIndicator:g}),C(()=>e.initialSwipe,a=>k(+a)),C(i,()=>k(t.active)),C(()=>e.autoplay,B),C([be,Se,()=>e.width,()=>e.height],Q),C(we(),a=>{a==="visible"?B():$()}),F(k),Ee(()=>k(t.active)),Ce(()=>k(t.active)),ke($),_e($),ie("touchmove",fe,{target:d}),()=>{var a;return x("div",{ref:s,class:D()},[x("div",{ref:d,style:L.value,class:D("track",{vertical:e.vertical}),onTouchstartPassive:de,onTouchend:p,onTouchcancel:p},[(a=r.default)==null?void 0:a.call(r)]),ge()])}}});const Je=W(ze),Le=Symbol(),se=Symbol(),re=()=>$e(se,null),Ve=e=>{const h=re();ae(Le,e),ae(se,w(()=>(h==null||h.value)&&e.value))},[Me,Oe]=U("swipe-item");var De=K({name:Me,setup(e,{slots:h}){let r;const s=ne({offset:0,inited:!1,mounted:!1}),{parent:d,index:t}=xe(le);if(!d)return;const b=w(()=>{const n={},{vertical:i}=d.props;return d.size.value&&(n[i?"height":"width"]=`${d.size.value}px`),s.offset&&(n.transform=`translate${i?"Y":"X"}(${s.offset}px)`),n}),f=w(()=>{const{loop:n,lazyRender:i}=d.props;if(!i||r)return!0;if(!s.mounted)return!1;const c=d.activeIndicator.value,v=d.count.value-1,y=c===0&&n?v:c-1,u=c===v&&n?0:c+1;return r=t.value===c||t.value===y||t.value===u,r}),S=n=>{s.offset=n};return F(()=>{G(()=>{s.mounted=!0})}),j({setOffset:S}),()=>{var n;return x("div",{class:Oe(),style:b.value},[f.value?(n=h.default)==null?void 0:n.call(h):null])}}});const qe=W(De),[Ye,_,He]=U("list"),Ne={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:ye("down"),loadingText:String,finishedText:String,immediateCheck:R};var Xe=K({name:Ye,props:Ne,emits:["load","update:error","update:loading"],setup(e,{emit:h,slots:r}){const s=z(e.loading),d=z(),t=z(),b=re(),f=Pe(d),S=w(()=>e.scroller||f.value),n=()=>{G(()=>{if(s.value||e.finished||e.disabled||e.error||b?.value===!1)return;const{direction:u}=e,P=+e.offset,g=te(S);if(!g.height||X(d))return;let E=!1;const L=te(t);u==="up"?E=g.top-L.top<=P:E=L.bottom-g.bottom<=P,E&&(s.value=!0,h("update:loading",!0),h("load"))})},i=()=>{if(e.finished){const u=r.finished?r.finished():e.finishedText;if(u)return x("div",{class:_("finished-text")},[u])}},c=()=>{h("update:error",!1),n()},v=()=>{if(e.error){const u=r.error?r.error():e.errorText;if(u)return x("div",{role:"button",class:_("error-text"),tabindex:0,onClick:c},[u])}},y=()=>{if(s.value&&!e.finished&&!e.disabled)return x("div",{class:_("loading")},[r.loading?r.loading():x(Ie,{class:_("loading-icon")},{default:()=>[e.loadingText||He("loading")]})])};return C(()=>[e.loading,e.finished,e.error],n),b&&C(b,u=>{u&&n()}),Be(()=>{s.value=e.loading}),F(()=>{e.immediateCheck&&n()}),j({check:n}),ie("scroll",n,{target:S,passive:!0}),()=>{var u;const P=(u=r.default)==null?void 0:u.call(r),g=x("div",{ref:t,class:_("placeholder")},null);return x("div",{ref:d,role:"feed",class:_(),"aria-busy":s.value},[e.direction==="down"?P:g,y(),i(),v(),e.direction==="up"?P:g])}}});const Qe=W(Xe);export{Qe as L,Je as S,qe as a,Ve as u};
