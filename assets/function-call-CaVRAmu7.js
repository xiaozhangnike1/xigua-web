import{E as K,G as ce,H as S,r as T,d as _,c as i,T as F,I as G,s as V,v as Y,m as B,a as ie,l as Z,k as re,F as ue,n as de,J as fe,L as ve,M as me,N as ye,g as he}from"./index-DO-l4tIR.js";import{t as I,b as A,n as k,o as ke,d as Ce,p as q,c as D,f as J,e as P,g as Oe,h as N,w as W,j as b,k as ge,l as we,q as Ie,i as be}from"./index-BZ0O1QaC.js";import{u as Q}from"./use-expose-buKm2G0G.js";import{I as X}from"./index-C0LVEZzw.js";import{u as Se}from"./use-touch-Uh-j500R.js";import{P as Pe}from"./on-popup-reopen-D5u2-ffw.js";import{u as j}from"./index-CzWMtT1i.js";import{c as pe}from"./interceptor-CeEcvsXT.js";import{H as xe}from"./constant-CRwwH2e9.js";import{L as Te}from"./index-T6Dye2l5.js";let Be=2e3;const ze=()=>++Be,Le={show:Boolean,zIndex:k,overlay:I,duration:k,teleport:[String,Object],lockScroll:I,lazyRender:I,beforeClose:Function,overlayProps:Object,overlayStyle:Object,overlayClass:A,transitionAppear:Boolean,closeOnClickOverlay:I};let p=0;const $="van-overflow-hidden";function Ae(e,t){const o=Se(),l="01",n="10",r=v=>{o.move(v);const c=o.deltaY.value>0?n:l,d=Ce(v.target,e.value),{scrollHeight:y,offsetHeight:O,scrollTop:g}=d;let m="11";g===0?m=O>=y?"00":"01":g+O>=y&&(m="10"),m!=="11"&&o.isVertical()&&!(parseInt(m,2)&parseInt(c,2))&&q(v,!0)},u=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",r,{passive:!1}),p||document.body.classList.add($),p++},a=()=>{p&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",r),p--,p||document.body.classList.remove($))},f=()=>t()&&u(),C=()=>t()&&a();ke(f),K(C),ce(C),S(t,v=>{v?u():a()})}function ee(e){const t=T(!1);return S(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const[Ee,_e]=D("overlay"),De={show:Boolean,zIndex:k,duration:k,className:A,lockScroll:I,lazyRender:I,customStyle:Object,teleport:[String,Object]};var Ne=_({name:Ee,inheritAttrs:!1,props:De,setup(e,{attrs:t,slots:o}){const l=T(),n=ee(()=>e.show||!e.lazyRender),r=a=>{e.lockScroll&&q(a,!0)},u=n(()=>{var a;const f=P(Oe(e.zIndex),e.customStyle);return N(e.duration)&&(f.animationDuration=`${e.duration}s`),V(i("div",B({ref:l,style:f,class:[_e(),e.className]},t),[(a=o.default)==null?void 0:a.call(o)]),[[Y,e.show]])});return J("touchmove",r,{target:l}),()=>{const a=i(F,{name:"van-fade",appear:!0},{default:u});return e.teleport?i(G,{to:e.teleport},{default:()=>[a]}):a}}});const Re=W(Ne),Me=P({},Le,{round:Boolean,position:b("center"),closeIcon:b("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:b("top-right"),destroyOnClose:Boolean,safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[je,H]=D("popup");var $e=_({name:je,inheritAttrs:!1,props:Me,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:l}){let n,r;const u=T(),a=T(),f=ee(()=>e.show||!e.lazyRender),C=ie(()=>{const s={zIndex:u.value};if(N(e.duration)){const h=e.position==="center"?"animationDuration":"transitionDuration";s[h]=`${e.duration}s`}return s}),v=()=>{n||(n=!0,u.value=e.zIndex!==void 0?+e.zIndex:ze(),t("open"))},c=()=>{n&&pe(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},d=s=>{t("clickOverlay",s),e.closeOnClickOverlay&&c()},y=()=>{if(e.overlay){const s=P({show:e.show,class:e.overlayClass,zIndex:u.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0},e.overlayProps);return i(Re,B(s,j(),{onClick:d}),{default:l["overlay-content"]})}},O=s=>{t("clickCloseIcon",s),c()},g=()=>{if(e.closeable)return i(X,{role:"button",tabindex:0,name:e.closeIcon,class:[H("close-icon",e.closeIconPosition),xe],classPrefix:e.iconPrefix,onClick:O},null)};let m;const te=()=>{m&&clearTimeout(m),m=setTimeout(()=>{t("opened")})},oe=()=>t("closed"),ne=s=>t("keydown",s),ae=f(()=>{var s;const{destroyOnClose:h,round:E,position:z,safeAreaInsetTop:se,safeAreaInsetBottom:le,show:M}=e;if(!(!M&&h))return V(i("div",B({ref:a,style:C.value,role:"dialog",tabindex:0,class:[H({round:E,[z]:z}),{"van-safe-area-top":se,"van-safe-area-bottom":le}],onKeydown:ne},o,j()),[(s=l.default)==null?void 0:s.call(l),g()]),[[Y,M]])}),R=()=>{const{position:s,transition:h,transitionAppear:E}=e,z=s==="center"?"van-fade":`van-popup-slide-${s}`;return i(F,{name:h||z,appear:E,onAfterEnter:te,onAfterLeave:oe},{default:ae})};return S(()=>e.show,s=>{s&&!n&&(v(),o.tabindex===0&&de(()=>{var h;(h=a.value)==null||h.focus()})),!s&&n&&(n=!1,t("close"))}),Q({popupRef:a}),Ae(a,()=>e.show&&e.lockScroll),J("popstate",()=>{e.closeOnPopstate&&(c(),r=!1)}),Z(()=>{e.show&&v()}),re(()=>{r&&(t("update:show",!0),r=!1)}),K(()=>{e.show&&e.teleport&&(c(),r=!0)}),fe(Pe,()=>e.show),()=>e.teleport?i(G,{to:e.teleport},{default:()=>[y(),R()]}):i(ue,null,[y(),R()])}});const He=W($e);let x=0;function Ue(e){e?(x||document.body.classList.add("van-toast--unclickable"),x++):x&&(x--,x||document.body.classList.remove("van-toast--unclickable"))}const[Ke,w]=D("toast"),Fe=["show","overlay","teleport","transition","overlayClass","overlayStyle","closeOnClickOverlay","zIndex"],Ge={icon:String,show:Boolean,type:b("text"),overlay:Boolean,message:k,iconSize:k,duration:ge(2e3),position:b("middle"),teleport:[String,Object],wordBreak:String,className:A,iconPrefix:String,transition:b("van-fade"),loadingType:String,forbidClick:Boolean,overlayClass:A,overlayStyle:Object,closeOnClick:Boolean,closeOnClickOverlay:Boolean,zIndex:k};var Ve=_({name:Ke,props:Ge,emits:["update:show"],setup(e,{emit:t,slots:o}){let l,n=!1;const r=()=>{const c=e.show&&e.forbidClick;n!==c&&(n=c,Ue(n))},u=c=>t("update:show",c),a=()=>{e.closeOnClick&&u(!1)},f=()=>clearTimeout(l),C=()=>{const{icon:c,type:d,iconSize:y,iconPrefix:O,loadingType:g}=e;if(c||d==="success"||d==="fail")return i(X,{name:c||d,size:y,class:w("icon"),classPrefix:O},null);if(d==="loading")return i(Te,{class:w("loading"),size:y,type:g},null)},v=()=>{const{type:c,message:d}=e;if(o.message)return i("div",{class:w("text")},[o.message()]);if(N(d)&&d!=="")return c==="html"?i("div",{key:0,class:w("text"),innerHTML:String(d)},null):i("div",{class:w("text")},[d])};return S(()=>[e.show,e.forbidClick],r),S(()=>[e.show,e.type,e.message,e.duration],()=>{f(),e.show&&e.duration>0&&(l=setTimeout(()=>{u(!1)},e.duration))}),Z(r),ve(r),()=>i(He,B({class:[w([e.position,e.wordBreak==="normal"?"break-normal":e.wordBreak,{[e.type]:!e.icon}]),e.className],lockScroll:!1,onClick:a,onClosed:f,"onUpdate:show":u},we(e,Fe)),{default:()=>[C(),v()]})}});function Ye(){const e=ye({show:!1}),t=n=>{e.show=n},o=n=>{P(e,n,{transitionAppear:!0}),t(!0)},l=()=>t(!1);return Q({open:o,close:l,toggle:t}),{open:o,close:l,state:e,toggle:t}}function Ze(e){const t=me(e),o=document.createElement("div");return document.body.appendChild(o),{instance:t.mount(o),unmount(){t.unmount(),document.body.removeChild(o)}}}const qe={icon:"",type:"text",message:"",className:"",overlay:!1,onClose:void 0,onOpened:void 0,duration:2e3,teleport:"body",iconSize:void 0,iconPrefix:void 0,position:"middle",transition:"van-fade",forbidClick:!1,loadingType:void 0,overlayClass:"",overlayStyle:void 0,closeOnClick:!1,closeOnClickOverlay:!1};let L=[],Je=!1,U=P({},qe);const We=new Map;function Qe(e){return be(e)?e:{message:e}}function Xe(){const{instance:e}=Ze({setup(){const t=T(""),{open:o,state:l,close:n,toggle:r}=Ye(),u=()=>{},a=()=>i(Ve,B(l,{onClosed:u,"onUpdate:show":r}),null);return S(t,f=>{l.message=f}),he().render=a,{open:o,close:n,message:t}}});return e}function et(){if(!L.length||Je){const e=Xe();L.push(e)}return L[L.length-1]}function dt(e={}){if(!Ie)return{};const t=et(),o=Qe(e);return t.open(P({},U,We.get(o.type||U.type),o)),t}export{He as P,dt as a,Ve as s};
