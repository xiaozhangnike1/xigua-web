import{t as O,m as Y,n as ee,c as X,u as me,Y as we,D as be,l as ie,U as N,r as H,H as M,p as Te,N as Se,O as xe,w as K,b as ye,v as Pe,S as Ae,J as te}from"./index-DwmRrwJ5.js";import{c as Ce,u as W,L as Ee}from"./request-Ds_MayXX.js";import{d as j,r as R,E as ne,a as w,G as C,l as F,k as ke,P as _e,L as $e,c as x,n as V,S as Be,H as ae,U as Le}from"./index-D-goK5yG.js";const[le,D]=X("swipe"),Oe={loop:O,width:ee,height:ee,vertical:Boolean,autoplay:Y(0),duration:Y(500),touchable:O,lazyRender:Boolean,initialSwipe:Y(0),indicatorColor:String,showIndicators:O,stopPropagation:O},oe=Symbol(le);var Re=j({name:le,props:Oe,emits:["change","dragStart","dragEnd"],setup(e,{emit:h,slots:c}){const s=R(),d=R(),t=ne({rect:null,width:0,height:0,offset:0,active:0,swiping:!1});let T=!1;const v=Ce(),{children:S,linkChildren:n}=me(oe),i=w(()=>S.length),r=w(()=>t[e.vertical?"height":"width"]),f=w(()=>e.vertical?v.deltaY.value:v.deltaX.value),y=w(()=>t.rect?(e.vertical?t.rect.height:t.rect.width)-r.value*i.value:0),u=w(()=>r.value?Math.ceil(Math.abs(y.value)/r.value):i.value),P=w(()=>i.value*r.value),g=w(()=>(t.active+i.value)%i.value),E=w(()=>{const a=e.vertical?"vertical":"horizontal";return v.direction.value===a}),z=w(()=>{const a={transitionDuration:`${t.swiping?0:e.duration}ms`,transform:`translate${e.vertical?"Y":"X"}(${+t.offset.toFixed(2)}px)`};if(r.value){const o=e.vertical?"height":"width",l=e.vertical?"width":"height";a[o]=`${P.value}px`,a[l]=e[l]?`${e[l]}px`:""}return a}),re=a=>{const{active:o}=t;return a?e.loop?H(o+a,-1,i.value):H(o+a,0,u.value):o},G=(a,o=0)=>{let l=a*r.value;e.loop||(l=Math.min(l,-y.value));let b=o-l;return e.loop||(b=H(b,y.value,0)),b},A=({pace:a=0,offset:o=0,emitChange:l})=>{if(i.value<=1)return;const{active:b}=t,m=re(a),L=G(m,o);if(e.loop){if(S[0]&&L!==y.value){const U=L<y.value;S[0].setOffset(U?P.value:0)}if(S[i.value-1]&&L!==0){const U=L>0;S[i.value-1].setOffset(U?-P.value:0)}}t.active=m,t.offset=L,l&&m!==b&&h("change",g.value)},I=()=>{t.swiping=!0,t.active<=-1?A({pace:i.value}):t.active>=i.value&&A({pace:-i.value})},ue=()=>{I(),v.reset(),M(()=>{t.swiping=!1,A({pace:-1,emitChange:!0})})},J=()=>{I(),v.reset(),M(()=>{t.swiping=!1,A({pace:1,emitChange:!0})})};let q;const $=()=>clearTimeout(q),B=()=>{$(),+e.autoplay>0&&i.value>1&&(q=setTimeout(()=>{J(),B()},+e.autoplay))},k=(a=+e.initialSwipe)=>{if(!s.value)return;const o=()=>{var l,b;if(!N(s)){const m={width:s.value.offsetWidth,height:s.value.offsetHeight};t.rect=m,t.width=+((l=e.width)!=null?l:m.width),t.height=+((b=e.height)!=null?b:m.height)}i.value&&(a=Math.min(i.value-1,a),a===-1&&(a=i.value-1)),t.active=a,t.swiping=!0,t.offset=G(a),S.forEach(m=>{m.setOffset(0)}),B()};N(s)?V().then(o):o()},Q=()=>k(t.active);let Z;const de=a=>{!e.touchable||a.touches.length>1||(v.start(a),T=!1,Z=Date.now(),$(),I())},ve=a=>{e.touchable&&t.swiping&&(v.move(a),E.value&&(!e.loop&&(t.active===0&&f.value>0||t.active===i.value-1&&f.value<0)||(Te(a,e.stopPropagation),A({offset:f.value}),T||(h("dragStart",{index:g.value}),T=!0))))},p=()=>{if(!e.touchable||!t.swiping)return;const a=Date.now()-Z,o=f.value/a;if((Math.abs(o)>.25||Math.abs(f.value)>r.value/2)&&E.value){const b=e.vertical?v.offsetY.value:v.offsetX.value;let m=0;e.loop?m=b>0?f.value>0?-1:1:0:m=-Math[f.value>0?"ceil":"floor"](f.value/r.value),A({pace:m,emitChange:!0})}else f.value&&A({pace:0});T=!1,t.swiping=!1,h("dragEnd",{index:g.value}),B()},fe=(a,o={})=>{I(),v.reset(),M(()=>{let l;e.loop&&a===i.value?l=t.active===0?0:a:l=a%i.value,o.immediate?M(()=>{t.swiping=!1}):t.swiping=!1,A({pace:l-t.active,emitChange:!0})})},he=(a,o)=>{const l=o===g.value,b=l?{backgroundColor:e.indicatorColor}:void 0;return x("i",{style:b,class:D("indicator",{active:l})},null)},ge=()=>{if(c.indicator)return c.indicator({active:g.value,total:i.value});if(e.showIndicators&&i.value>1)return x("div",{class:D("indicators",{vertical:e.vertical})},[Array(i.value).fill("").map(he)])};return W({prev:ue,next:J,state:t,resize:Q,swipeTo:fe}),n({size:r,props:e,count:i,activeIndicator:g}),C(()=>e.initialSwipe,a=>k(+a)),C(i,()=>k(t.active)),C(()=>e.autoplay,B),C([Se,xe,()=>e.width,()=>e.height],Q),C(we(),a=>{a==="visible"?B():$()}),F(k),ke(()=>k(t.active)),be(()=>k(t.active)),_e($),$e($),ie("touchmove",ve,{target:d}),()=>{var a;return x("div",{ref:s,class:D()},[x("div",{ref:d,style:z.value,class:D("track",{vertical:e.vertical}),onTouchstartPassive:de,onTouchend:p,onTouchcancel:p},[(a=c.default)==null?void 0:a.call(c)]),ge()])}}});const je=K(Re),ze=Symbol(),se=Symbol(),ce=()=>Be(se,null),Fe=e=>{const h=ce();ae(ze,e),ae(se,w(()=>(h==null||h.value)&&e.value))},[Ie,Me]=X("swipe-item");var De=j({name:Ie,setup(e,{slots:h}){let c;const s=ne({offset:0,inited:!1,mounted:!1}),{parent:d,index:t}=ye(oe);if(!d)return;const T=w(()=>{const n={},{vertical:i}=d.props;return d.size.value&&(n[i?"height":"width"]=`${d.size.value}px`),s.offset&&(n.transform=`translate${i?"Y":"X"}(${s.offset}px)`),n}),v=w(()=>{const{loop:n,lazyRender:i}=d.props;if(!i||c)return!0;if(!s.mounted)return!1;const r=d.activeIndicator.value,f=d.count.value-1,y=r===0&&n?f:r-1,u=r===f&&n?0:r+1;return c=t.value===r||t.value===y||t.value===u,c}),S=n=>{s.offset=n};return F(()=>{V(()=>{s.mounted=!0})}),W({setOffset:S}),()=>{var n;return x("div",{class:Me(),style:T.value},[v.value?(n=h.default)==null?void 0:n.call(h):null])}}});const Ve=K(De),[Ye,_,Ue]=X("list"),He={error:Boolean,offset:Y(300),loading:Boolean,disabled:Boolean,finished:Boolean,scroller:Object,errorText:String,direction:Pe("down"),loadingText:String,finishedText:String,immediateCheck:O};var Ne=j({name:Ye,props:He,emits:["load","update:error","update:loading"],setup(e,{emit:h,slots:c}){const s=R(e.loading),d=R(),t=R(),T=ce(),v=Ae(d),S=w(()=>e.scroller||v.value),n=()=>{V(()=>{if(s.value||e.finished||e.disabled||e.error||T?.value===!1)return;const{direction:u}=e,P=+e.offset,g=te(S);if(!g.height||N(d))return;let E=!1;const z=te(t);u==="up"?E=g.top-z.top<=P:E=z.bottom-g.bottom<=P,E&&(s.value=!0,h("update:loading",!0),h("load"))})},i=()=>{if(e.finished){const u=c.finished?c.finished():e.finishedText;if(u)return x("div",{class:_("finished-text")},[u])}},r=()=>{h("update:error",!1),n()},f=()=>{if(e.error){const u=c.error?c.error():e.errorText;if(u)return x("div",{role:"button",class:_("error-text"),tabindex:0,onClick:r},[u])}},y=()=>{if(s.value&&!e.finished&&!e.disabled)return x("div",{class:_("loading")},[c.loading?c.loading():x(Ee,{class:_("loading-icon")},{default:()=>[e.loadingText||Ue("loading")]})])};return C(()=>[e.loading,e.finished,e.error],n),T&&C(T,u=>{u&&n()}),Le(()=>{s.value=e.loading}),F(()=>{e.immediateCheck&&n()}),W({check:n}),ie("scroll",n,{target:S,passive:!0}),()=>{var u;const P=(u=c.default)==null?void 0:u.call(c),g=x("div",{ref:t,class:_("placeholder")},null);return x("div",{ref:d,role:"feed",class:_(),"aria-busy":s.value},[e.direction==="down"?P:g,y(),i(),f(),e.direction==="up"?P:g])}}});const Ge=K(Ne);export{Ge as L,je as S,Ve as a,Fe as u};
